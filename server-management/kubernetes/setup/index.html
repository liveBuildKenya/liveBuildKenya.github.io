<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Setup - Dev Docs</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">Dev Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../.." class="nav-link">Introduction</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Server Management <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../introduction/" class="dropdown-item">Introduction</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Security</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../security/secure-linux-server/" class="dropdown-item">Secure Linux Server</a>
</li>
            
<li>
    <a href="../../security/ddos/" class="dropdown-item">DDOS</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">SSL/TSL</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../security/ssl/ssl-setup/" class="dropdown-item">Setup</a>
</li>
            
<li>
    <a href="../../security/ssl/install-ca-certificate/" class="dropdown-item">Install Certificate</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Web Servers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../web-servers/apache/concurrency/" class="dropdown-item">Apache</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Kubernetes</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active">Setup</a>
</li>
            
<li>
    <a href="../image-deployment/" class="dropdown-item">Image Deployment</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Kafka</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../kafka/installation/" class="dropdown-item">Installation</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Database Management <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Postgre</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../database-management/postgre/installation/" class="dropdown-item">Installation</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Replication</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../database-management/postgre/replication/" class="dropdown-item">Streaming Replication</a>
</li>
    </ul>
  </li>
            
<li>
    <a href="../../../database-management/postgre/upgrade/" class="dropdown-item">Upgrade</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../web-servers/apache/concurrency/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../image-deployment/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#managing-kubernetes-on-ubuntu-2004-server" class="nav-link">Managing Kubernetes on Ubuntu 20.04 Server</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#lab-setup" class="nav-link">Lab Setup</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-1-set-the-hostname-and-add-entries-on-the-etchosts-file" class="nav-link">Step 1 - Set the hostname and add entries on the /etc/hosts file</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-2-install-a-container-runtime-on-all-3-nodes" class="nav-link">Step 2 Install a Container runtime on all 3 nodes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-3-disable-swap-and-enable-ip-forwarding-on-all-nodes" class="nav-link">Step 3 Disable swap and enable IP forwarding on all nodes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-4-install-kubectl-kubelet-and-kubeadm-on-all-nodes" class="nav-link">Step 4 -Install Kubectl, kubelet and kubeadm on all nodes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-5-initialize-kubernetes-cluster-using-kubeadm-from-master-node" class="nav-link">Step 5 - Initialize Kubernetes Cluster using kubeadm (from master node)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-6-deploy-calico-pod-network-add-on-master-node" class="nav-link">Step 6 - Deploy Calico Pod Network Add-on (Master Node)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="managing-kubernetes-on-ubuntu-2004-server">Managing Kubernetes on Ubuntu 20.04 Server</h1>
<p>Kubernetes (k8s) is a free and open-source container orchestration tool. It is used for deploying, scaling and managing containerized based applications. In this article we will demonstrate how to install a Kubernetes cluster using <strong>kubeadm</strong>. Before you begin ensure you have the following:
- One or more machines running a deb/rpm-compatible Linux OS; for example: Ubuntu or CentOS.
- 2 GiB or more of RAM per machine--any less leaves little room for your apps.
- At least 2 CPUs on the machine that you use as a control-plane node.
- Full network connectivity among all machines in the cluster. You can use either a public or a private network.
- Privileged user with sudo rights</p>
<h2 id="lab-setup">Lab Setup</h2>
<p>The foloowing are the details of my lab setup:</p>
<ul>
<li>
<p>Machine 1 (Ubuntu 20.04 LTS Server) – kubemaster.com – 192.168.1.4</p>
</li>
<li>
<p>Machine 2 (Ubuntu 20.04 LTS Server) – kubeworkernode1.com – 192.168.1.5</p>
</li>
<li>
<p>Machine 3 (Ubuntu 20.04 LTS Server) – kubeworkernode2.com – 192.168.1.6</p>
</li>
</ul>
<h2 id="step-1-set-the-hostname-and-add-entries-on-the-etchosts-file">Step 1 - Set the hostname and add entries on the /etc/hosts file</h2>
<p>On each of the machine set the hostname on each node.</p>
<p>master node:</p>
<pre><code class="language-bash">sudo hostnamectl set-hostname &quot;kubemaster.com&quot;
</code></pre>
<p>worker node 1:</p>
<pre><code class="language-bash">sudo hostnamectl set-hostname &quot;kubeworkernode1.com&quot;
</code></pre>
<p>worker node 2:</p>
<pre><code class="language-bash">sudo hostnamectl set-hostname &quot;kubeworkernode2.com&quot;
</code></pre>
<p>After the above commands, add the following entries in the /etc/hosts files on each node,</p>
<pre><code>192.168.1.4 kubemaster.com
192.168.1.5 kubeworkernode1.com
192.168.1.6 kubeworkernode2.com
</code></pre>
<h2 id="step-2-install-a-container-runtime-on-all-3-nodes">Step 2 Install a Container runtime on all 3 nodes</h2>
<p>For this set up we will install docker.</p>
<h3 id="uninstall-old-version-of-docker">Uninstall old version of docker.</h3>
<pre><code class="language-bash">sudo apt-get remove docker docker-engine docker.io containerd runc
</code></pre>
<p>It’s OK if apt-get reports that none of these packages are installed. The contents of /var/lib/docker/, including images, containers, volumes, and networks, are preserved.</p>
<h3 id="set-up-the-repository">Set up the repository</h3>
<ul>
<li>Update the apt package index and install packages to allow apt to use a repository over HTTPS:</li>
</ul>
<pre><code class="language-bash">sudo apt-get update
</code></pre>
<pre><code class="language-bash">sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg \
    lsb-release
</code></pre>
<ul>
<li>Add Docker’s official GPG key:</li>
</ul>
<pre><code class="language-bash">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
</code></pre>
<ul>
<li>Use the following command to set up the stable repository. To add the nightly or test repository, add the word nightly or test (or both) after the word stable in the commands below.</li>
</ul>
<pre><code class="language-bash">echo \
  &quot;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable&quot; | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</code></pre>
<h3 id="install-docker-engine">Install Docker Engine</h3>
<ul>
<li>Update the apt package index, and install the latest version of Docker Engine and containerd, or go to the next step to install a specific version:</li>
</ul>
<pre><code class="language-bash">sudo apt-get update
</code></pre>
<pre><code class="language-bash">sudo apt-get install docker-ce docker-ce-cli containerd.io
</code></pre>
<ul>
<li>To install a specific version of Docker Engine, list the available versions in the repo, then select and install:<ul>
<li>List the versions available in your repo:</li>
</ul>
</li>
</ul>
<pre><code class="language-bash">apt-cache madison docker-ce
</code></pre>
<p>Install a specific version using the version string from the second column</p>
<pre><code class="language-bash">sudo apt-get install docker-ce=&lt;VERSION_STRING&gt; docker-ce-cli=&lt;VERSION_STRING&gt; containerd.io
</code></pre>
<p>Now start and enable docker service on each node using beneath systemctl command</p>
<pre><code class="language-bash">sudo systemctl enable docker.service --now
</code></pre>
<p>Run the following command to verify the status of docker service and its version,</p>
<pre><code class="language-bash">systemctl status docker
</code></pre>
<pre><code class="language-bash">docker --version
</code></pre>
<h2 id="step-3-disable-swap-and-enable-ip-forwarding-on-all-nodes">Step 3 Disable swap and enable IP forwarding on all nodes</h2>
<p>To disable swap, edit /etc/fstab file and comment out the line which includes entry either swap partition or swap file.</p>
<pre><code class="language-bash">sudo vi /etc/fstab
</code></pre>
<p><img alt="Disable swap" src="../../../assets/kubernetes/Swap-disable-Ubuntu-20-04-768x235.webp" /></p>
<p>Save &amp; exit the file</p>
<p>Run swapoff command to disable the swap on the fly</p>
<pre><code class="language-bash">sudo swapoff -a
</code></pre>
<p>To enable the ip forwarding permanently, edit the file “/etc/sysctl.conf” and look for line “net.ipv4.ip_forward=1” and un-comment it. After making the changes in the file, execute the following command</p>
<pre><code class="language-bash">sudo sysctl -p
</code></pre>
<h2 id="step-4-install-kubectl-kubelet-and-kubeadm-on-all-nodes">Step 4 -Install Kubectl, kubelet and kubeadm on all nodes</h2>
<ul>
<li>Update the apt package index and install packages needed to use the Kubernetes apt repository</li>
</ul>
<pre><code class="language-bash">sudo apt-get update
</code></pre>
<pre><code class="language-bash">sudo apt-get install -y apt-transport-https ca-certificates curl
</code></pre>
<ul>
<li>Download the Google Cloud public signing key:</li>
</ul>
<pre><code class="language-bash">sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
</code></pre>
<ul>
<li>Add the Kubernetes apt repository:</li>
</ul>
<pre><code class="language-bash">echo &quot;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&quot; | sudo tee /etc/apt/sources.list.d/kubernetes.list
</code></pre>
<ul>
<li>Update apt package index, install kubelet, kubeadm and kubectl, and pin their version:</li>
</ul>
<pre><code class="language-bash">sudo apt-get update
</code></pre>
<pre><code class="language-bash">sudo apt-get install -y kubelet kubeadm kubectl
</code></pre>
<h2 id="step-5-initialize-kubernetes-cluster-using-kubeadm-from-master-node">Step 5 - Initialize Kubernetes Cluster using kubeadm (from master node)</h2>
<p>Login to your master node kubemaster.com and run below ‘kubeadm init‘ command to initialize Kubernetes cluster,</p>
<pre><code class="language-bash">sudo kubeadm init --control-plane-endpoint=kubemaster.com
</code></pre>
<p>Once the cluster is initialized successfully, follow the instruction on the output</p>
<p>Now Join the worker nodes kubeworkernode1.com and kubeworkernode2.com to cluster, command to join the cluster is already there in the output. Copy “kubeadm join” command and paste it on both nodes (worker nodes).</p>
<p>From the master node run “kubectl get nodes” command to verify nodes status.</p>
<p>As we can see both worker nodes and master node have joined the cluster, but status of each node is “NotReady”. To make the status “Ready” we must deploy Container Network Interface (CNI) based Pod network add-ons like calico, kube-router and weave-net. As the name suggests, pod network add-ons allow pods to communicate each other.</p>
<h2 id="step-6-deploy-calico-pod-network-add-on-master-node">Step 6 - Deploy Calico Pod Network Add-on (Master Node)</h2>
<p>From the master node, run the following command to install Calico pod network add-on,</p>
<pre><code class="language-bash">kubectl apply -f https://docs.projectcalico.org/v3.14/manifests/calico.yaml
</code></pre>
<p>Once it has been deployed successfully then nodes status will become ready, let’s re-run kubectl command to verify nodes status</p>
<p>Confirm and veryfy the status of pods from all namespaces</p>
<pre><code class="language-bash">kubectl get pods --all-namespaces
</code></pre>
<p>Note: To enable bash completion feature on your master node, execute the followings</p>
<pre><code class="language-bash">echo 'source &lt;(kubectl completion bash)' &gt;&gt;~/.bashrc
</code></pre>
<pre><code class="language-bash">source .bashrc
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
